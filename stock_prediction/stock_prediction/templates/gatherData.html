<!DOCTYPE html>
<html>
  <head>
    <title>Stock Ticker Input</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>
  <body>
    <h1>Enter a Stock Ticker:</h1>
    <input type="text" id="tickerInput" />
    <button type="button" onclick="displayIncomeStatement()">Get Income Statement</button>
    <button type="button" onclick="displayStockPrices()">Get Historical Stock Prices</button>

    <p id="output"></p>

    <div id="stockPricesTable"></div>
    <div id="incomeStatementTable"></div>


    <script>
      function displayStockPrices() {
        const ticker = document.getElementById('tickerInput').value.toUpperCase();
        $.ajax({
          url: `/stock_prices/${ticker}`,
          dataType: 'json',
          success: function(data) {
            const table = createTable(data);
            const output = document.getElementById('stockPricesTable');
            output.innerHTML = '';
            output.appendChild(table);
          }
        });
      }
      
      function displayIncomeStatement() {
        const ticker = document.getElementById('tickerInput').value.toUpperCase();
        $.ajax({
          url: `/income_statement/${ticker}`,
          dataType: 'json',
          success: function(data) {
            const table = createTable(data);
            const output = document.getElementById('incomeStatementTable');
            output.innerHTML = '';
            output.appendChild(table);
          }
        });
      }

      function createTable(data) {
        const table = document.createElement('table');
        const thead = table.createTHead();
        const tr = thead.insertRow(-1);
        const headers = ['dateTime'];
        for (const key in data) {
          headers.push(key);
        }
        for (const header of headers) {
          const th = document.createElement('th');
          th.textContent = header;
          tr.appendChild(th);
        }
        const tbody = table.createTBody();
        const fields = Object.keys(data[Object.keys(data)[0]]);
        for (const field of fields) {
          const tr = tbody.insertRow(-1);
          const td = document.createElement('td');
          td.textContent = field;
          tr.appendChild(td);
          for (const key in data) {
            const value = data[key][field];
            const td = document.createElement('td');
            td.textContent = value;
            tr.appendChild(td);
          }
        }
        return table;
      }      
    </script>
  </body>
</html>
